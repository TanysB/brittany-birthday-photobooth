<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Photo Album - Brittany's 22nd Birthday</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #F5DEB3, #DEB887);
            min-height: 100vh;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .album-container {
            position: relative;
            width: 100%;
            max-width: 320px;
            background-image: url('album.png');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            aspect-ratio: 1/2.5;
            margin-bottom: 25px;
        }

        /* Photo overlays positioned exactly in the white rectangles */
        .photo-overlay {
            position: absolute;
            overflow: hidden;
        }

        /* Top photo */
        .photo-1 {
            top: 2.5%;
            left: 8.9%;
            width: 82%;
            height: 24%;
        }

        /* Middle photo */
        .photo-2 {
            top: 28.5%;
            left: 8.9%;
            width: 82%;
            height: 24%;
        }

        /* Bottom photo */
        .photo-3 {
            top: 54.5%;
            left: 8.9%;
            width: 82.2%;
            height: 24%;
        }

        .album-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            border-radius: 4px;
        }

        .photo-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #F5DEB3, #DEB887);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #654321;
            font-size: 0.8em;
            text-align: center;
            padding: 5px;
            line-height: 1.2;
            border: 1px dashed #654321;
            border-radius: 4px;
        }

        .buttons-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 320px;
        }

        .action-button {
            background: linear-gradient(135deg, #228B22, #006400);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            font-family: 'Georgia', serif;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            width: 100%;
            max-width: 280px;
        }

        .action-button:hover {
            background: linear-gradient(135deg, #32CD32, #228B22);
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
        }

        .action-button:active {
            transform: translateY(0);
        }

        .action-button.secondary {
            background: linear-gradient(135deg, #4169E1, #1E3A8A);
        }

        .action-button.secondary:hover {
            background: linear-gradient(135deg, #6495ED, #4169E1);
        }

        .status-message {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: bold;
            display: none;
        }

        .status-success {
            background: rgba(76, 175, 80, 0.9);
            color: white;
            border: 2px solid #4CAF50;
        }

        .status-error {
            background: rgba(244, 67, 54, 0.9);
            color: white;
            border: 2px solid #f44336;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #654321;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: #654321;
            font-size: 1em;
            line-height: 1.6;
            max-width: 400px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.2em;
            color: #654321;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .album-container {
                max-width: 280px;
            }
            
            .action-button {
                padding: 12px 25px;
                font-size: 1em;
            }
        }

        @media (max-width: 480px) {
            .album-container {
                max-width: 250px;
            }
            
            body {
                padding: 10px;
            }
        }

        /* Share instructions for mobile */
        .share-instructions {
            background: rgba(101, 67, 33, 0.9);
            color: #F5DEB3;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
            max-width: 400px;
            line-height: 1.4;
        }

        .share-instructions h3 {
            margin-bottom: 10px;
            color: #F5DEB3;
        }
    </style>
</head>
<body>
    <div class="status-message" id="statusMessage"></div>
    <div class="loading" id="loading">Loading your photos...</div>

    <div class="album-container" id="albumContainer" style="display: none;">
        <div class="photo-overlay photo-1" id="photoSlot1">
            <div class="photo-placeholder">Loading Photo 1...</div>
        </div>
        <div class="photo-overlay photo-2" id="photoSlot2">
            <div class="photo-placeholder">Loading Photo 2...</div>
        </div>
        <div class="photo-overlay photo-3" id="photoSlot3">
            <div class="photo-placeholder">Loading Photo 3...</div>
        </div>
    </div>

    <div class="buttons-container" id="buttonsContainer" style="display: none;">
        <button class="action-button" onclick="downloadAlbum()">
            üì• Download Album
        </button>
        <button class="action-button secondary" onclick="shareAlbum()">
            üì± Take Screenshot
        </button>
    </div>

    <div class="share-instructions" id="shareInstructions" style="display: none;">
        <h3>üì± How to Save Your Photos:</h3>
        <p><strong>iPhone:</strong> Press and hold the album, then tap "Save to Photos"</p>
        <p><strong>Android:</strong> Press and hold the album, then tap "Download image"</p>
        <p><strong>Or:</strong> Take a screenshot of this page!</p>
    </div>

    <script>
        let photoData = [];

        // Get photos from URL parameters (embedded in QR code)
        function loadPhotosFromURL() {
            console.log('üîç Loading photos from URL parameters...');
            
            const urlParams = new URLSearchParams(window.location.search);
            
            // Check if we have photo data in URL
            const photo1 = urlParams.get('p1');
            const photo2 = urlParams.get('p2');
            const photo3 = urlParams.get('p3');
            const filter = urlParams.get('filter') || 'none';
            
            console.log('üì∏ Found URL params:', {
                hasPhoto1: !!photo1,
                hasPhoto2: !!photo2,
                hasPhoto3: !!photo3,
                filter: filter
            });

            if (!photo1 && !photo2 && !photo3) {
                console.log('‚ùå No photo data in URL');
                showError();
                return false;
            }

            // Decode photos from URL
            photoData = [];
            if (photo1) {
                try {
                    photoData[0] = decodeURIComponent(photo1);
                    console.log('‚úÖ Photo 1 decoded');
                } catch (e) {
                    console.error('‚ùå Error decoding photo 1:', e);
                }
            }
            
            if (photo2) {
                try {
                    photoData[1] = decodeURIComponent(photo2);
                    console.log('‚úÖ Photo 2 decoded');
                } catch (e) {
                    console.error('‚ùå Error decoding photo 2:', e);
                }
            }
            
            if (photo3) {
                try {
                    photoData[2] = decodeURIComponent(photo3);
                    console.log('‚úÖ Photo 3 decoded');
                } catch (e) {
                    console.error('‚ùå Error decoding photo 3:', e);
                }
            }

            displayPhotos();
            return true;
        }

        // Display photos in the album
        function displayPhotos() {
            console.log('üì∏ Displaying photos in album...');
            
            // Hide loading, show album
            document.getElementById('loading').style.display = 'none';
            document.getElementById('albumContainer').style.display = 'block';
            document.getElementById('buttonsContainer').style.display = 'flex';
            
            let photosLoaded = 0;
            
            for (let i = 0; i < 3; i++) {
                const slot = document.getElementById(`photoSlot${i + 1}`);
                
                if (photoData[i]) {
                    console.log(`üì∑ Loading photo ${i + 1}`);
                    const img = document.createElement('img');
                    img.className = 'album-photo';
                    img.alt = `Photo ${i + 1}`;
                    img.src = photoData[i];
                    
                    img.onload = () => {
                        console.log(`‚úÖ Photo ${i + 1} loaded successfully`);
                        photosLoaded++;
                        if (photosLoaded > 0) {
                            showStatus('‚úÖ Your photos are ready!', 'success');
                        }
                    };
                    
                    img.onerror = () => {
                        console.log(`‚ùå Photo ${i + 1} failed to load`);
                        slot.innerHTML = `<div class="photo-placeholder">Photo ${i + 1}<br>Failed to Load</div>`;
                    };
                    
                    slot.innerHTML = '';
                    slot.appendChild(img);
                } else {
                    console.log(`üìù No data for photo ${i + 1}`);
                    slot.innerHTML = `<div class="photo-placeholder">Photo ${i + 1}<br>Not Available</div>`;
                }
            }
            
            // Show sharing instructions after a delay
            setTimeout(() => {
                document.getElementById('shareInstructions').style.display = 'block';
            }, 2000);
        }

        // Show error when no photos found
        function showError() {
            document.getElementById('loading').style.display = 'none';
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'instructions';
            errorDiv.innerHTML = `
                <h3>‚ùå No Photos Found</h3>
                <p>This QR code doesn't contain any photo data.</p>
                <p>Please scan a QR code generated by the photo booth.</p>
            `;
            
            document.body.appendChild(errorDiv);
        }

        // Show status message
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status-message status-${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 4000);
        }

        // Download album functionality
        async function downloadAlbum() {
            console.log('üíæ Starting album download...');
            
            try {
                // Use html2canvas if available
                if (typeof html2canvas !== 'undefined') {
                    const albumContainer = document.getElementById('albumContainer');
                    const canvas = await html2canvas(albumContainer, {
                        allowTaint: true,
                        useCORS: true,
                        scale: 2,
                        backgroundColor: null
                    });
                    
                    // Create download link
                    const link = document.createElement('a');
                    link.download = 'Brittany_22nd_Birthday_Album.png';
                    link.href = canvas.toDataURL('image/png');
                    link.style.display = 'none';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    showStatus('üì• Album downloaded!', 'success');
                } else {
                    // Fallback for mobile devices
                    showStatus('üí° Use "Take Screenshot" instead', 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Download failed:', error);
                showStatus('üí° Try taking a screenshot instead', 'error');
            }
        }

        // Mobile-friendly share functionality
        function shareAlbum() {
            if (navigator.share) {
                // Use native sharing if available
                navigator.share({
                    title: "Brittany's 22nd Birthday Photos",
                    text: 'Check out these photos from the party!',
                    url: window.location.href
                }).then(() => {
                    showStatus('üì± Shared successfully!', 'success');
                }).catch(() => {
                    showScreenshotInstructions();
                });
            } else {
                showScreenshotInstructions();
            }
        }

        function showScreenshotInstructions() {
            const instructions = `
üì± To save these photos:

iPhone: Press Home + Power buttons together
Android: Press Volume Down + Power buttons together
Or: Press and hold the album image above

The screenshot will be saved to your photos!
            `;
            
            alert(instructions);
        }

        // Initialize page
        window.addEventListener('load', () => {
            console.log('üéâ Album page loaded');
            loadPhotosFromURL();
        });
    </script>
    
    <!-- html2canvas for download (may not work on all mobile devices) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</body>
</html>
